<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wisebud - Study Assistant</title>
  <link rel="stylesheet" href="../static/style.css" />
  <style>
    /* Dashboard-only layout to keep all 4 cards on the same row on wide screens */
    .container { grid-template-columns: repeat(4, minmax(260px, 1fr)); max-width: 1600px; }
    @media (max-width: 1400px) {
      .container { grid-template-columns: repeat(3, minmax(260px, 1fr)); }
    }
    @media (max-width: 1024px) {
      .container { grid-template-columns: repeat(2, minmax(260px, 1fr)); }
    }
    @media (max-width: 600px) {
      .container { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <script>
    if (!localStorage.getItem("wisebudUser")) {
      window.location.href = "login.html";
    }
    const params = new URLSearchParams(window.location.search);
    const course = params.get("course");
    if (!course) window.location.href = "course.html";
    localStorage.setItem("currentCourse", course);
  </script>

  <nav class="top-nav">
    <h1>
      <!-- Simple inline SVG logo mark -->
      <svg aria-hidden="true" focusable="false" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="24" y2="24" gradientUnits="userSpaceOnUse">
            <stop stop-color="#93c5fd"/>
            <stop offset="1" stop-color="#4f46e5"/>
          </linearGradient>
        </defs>
        <path d="M12 3l7 4v5c0 5-3.5 7.5-7 9-3.5-1.5-7-4-7-9V7l7-4z" fill="url(#g)"/>
        <path d="M12 7v10" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      Wisebud â€” <span id="current-course"></span>
    </h1>
    <div class="top-actions">
      <button id="theme-toggle" aria-label="Switch theme"></button>
    </div>
  </nav>

  <div id="status-message" class="status"></div>

  <main class="container">
    <!-- Upload & Summarize -->
    <section id="setup-area" class="card">
      <div class="card-header">Upload &amp; Summarize</div>
      <div class="card-content">
        <label for="source-select">Choose source:</label>
        <select id="source-select">
          <option value="local">Local File</option>
          <option value="drive">Google Drive</option>
          <option value="backend">Backend JSON</option>
        </select>

        <div class="source-panel" id="panel-local">
          <input type="file" id="file-upload" multiple />
        </div>

        <div class="source-panel hidden" id="panel-drive">
          <button id="drive-picker-btn">Select from Google Drive</button>
          <span id="drive-file-name"></span>
        </div>

        <div class="source-panel hidden" id="panel-backend">
          <button id="load-json-btn">Load JSON from Server</button>
          <span id="backend-status"></span>
        </div>

        <!-- Uploaded files list -->
        <div id="uploaded-files" class="uploaded-files">
          <strong>Uploaded Files:</strong>
          <ul id="file-list"></ul>
        </div>
      </div>
      <div class="card-footer">
        <button id="generate-btn" class="primary">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          Upload
        </button>
        <button id="summarize-btn" class="secondary">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 5h16M4 12h10M4 19h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          Summarize Notes
        </button>
      </div>
    </section>

    <!-- Study -->
    <section id="study-area" class="card">
      <div class="card-header">Study</div>
      <div class="card-content">
        <p>Practice and test yourself using flashcards and quizzes based on your uploaded notes.</p>
      </div>
      <div class="card-footer">
        <button class="primary" onclick="window.location.href='flashcard.html'">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="6" width="16" height="12" rx="2" stroke="currentColor" stroke-width="2"/><path d="M8 10h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          Study Flashcards
        </button>
        <button class="secondary"
          onclick="window.location.href=`quiz.html?course=${encodeURIComponent(localStorage.getItem('currentCourse'))}`">Take
          a Quiz
        </button>
      </div>
    </section>


    <!-- Chat -->
    <section id="chat-section" class="card">
      <div class="card-header">Chat</div>
      <div class="card-content">
        <form id="chat-form">
          <textarea id="chat-input" placeholder="Type a message..."></textarea>
          <button type="submit" class="primary">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 12l16-8-8 16-2-6-6-2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
            Ask
          </button>
        </form>
        <textarea id="chat-log" readonly></textarea>
      </div>
    </section>

    <!-- Focus Timer -->
    <section id="focus-section" class="card">
      <div class="card-header">Focus Timer</div>
      <div class="card-content">
        <div id="timer-display">
          <svg id="clock-svg" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" stroke="var(--color-primary)" stroke-width="5" fill="none"></circle>
            <text x="50" y="55" text-anchor="middle" font-size="20" fill="var(--color-primary)">25:00</text>
          </svg>
        </div>
        <div class="timer-buttons">
          <button id="set-timer-btn" class="secondary">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 8v4l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z" stroke="currentColor" stroke-width="2"/></svg>
            Set Timer
          </button>
          <button id="start-timer-btn" class="primary">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5v14l11-7-11-7z" fill="currentColor"/></svg>
            Start
          </button>
          <button id="pause-timer-btn" class="secondary">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5h3v14H8zM13 5h3v14h-3z" fill="currentColor"/></svg>
            Pause
          </button>
        </div>
      </div>

      <div id="timer-modal" class="modal hidden">
        <div class="modal-content">
          <h3>Set Timer</h3>
          <input type="text" id="timer-input" placeholder="Enter time (hh:mm:ss)" pattern="^\d{1,2}:\d{2}:\d{2}$" />
          <button id="save-timer-btn" class="primary">Save</button>
          <button id="cancel-timer-btn" class="secondary">Cancel</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Break Reminder Overlay -->
  <div id="break-reminder" class="overlay hidden">
    <p>Time for a break!</p>
    <button id="resume-btn" class="primary">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 4h4v16H5z" fill="currentColor"/><path d="M10 12l9-7v14l-9-7z" fill="currentColor"/></svg>
      Resume
    </button>
  </div>

  <script src="../static/script.js"></script>
  <script src="../static/theme.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const course = localStorage.getItem("currentCourse");
      const courseSpan = document.getElementById("current-course");
      if (course && courseSpan) {
        courseSpan.textContent = course;
      }
    });
  </script>


</body>

</html>